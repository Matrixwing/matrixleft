<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title>我的主页</title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">

		<link rel="stylesheet" href="styles/mui.min.css">
		<link rel="stylesheet" type="text/css" href="styles/main.css"/>
		<link rel="stylesheet" type="text/css" href="styles/pages/home.css"/>
	</head>

	<body class="mui-fullscreen">
		<!--页面主结构开始-->
		<div id="app" class="mui-views">
			<div class="mui-view">
				<div class="mui-navbar">
				</div>
				<div class="mui-pages">
				</div>
			</div>
		</div>
		<!--页面主结构结束-->
		<!--单页面开始-->
        <div id="account" class="mui-page">
			<div class="mui-navbar-inner mui-bar mui-bar-nav">
				<button type="button" class="mui-left mui-action-back mui-btn  mui-btn-link mui-btn-nav mui-pull-left">
					<span class="mui-icon mui-icon-left-nav"></span>主页
				</button>
				<h1 class="mui-center mui-title">个人信息</h1>
			</div>
			<div class="mui-page-content">
				<div class="mui-scroll-wrapper">
					<div class="mui-scroll">
						<ul class="mui-table-view">
							<li class="mui-table-view-cell">
								<a id="head" class="mui-navigate-right">头像
								<span class="mui-pull-right head">
									<img class="head-img mui-action-preview" id="head-img1" src=""/>
								</span>
							</a>
							</li>
							<li class="mui-table-view-cell">
								<a>昵称<span class="mui-pull-right">Hbuilder</span></a>
							</li>
						</ul>
						<ul class="mui-table-view">
							<li class="mui-table-view-cell">
								<a>微信号<span class="mui-pull-right">88888888</span></a>
							</li>
							<li class="mui-table-view-cell">
								<a>手机号<span class="mui-pull-right">18601234567</span></a>
							</li>
						</ul>
					</div>
				</div>
			</div>
		</div>
		<div id="reg_phone" class="mui-page">
			<div class="mui-navbar-inner mui-bar mui-bar-nav">
				<button type="button" class="mui-left mui-action-back mui-btn  mui-btn-link mui-btn-nav mui-pull-left">
					<span class="mui-icon mui-icon-left-nav"></span>个人中心
				</button>
				<h1 class="mui-center mui-title">绑定手机号</h1>
			</div>
			<div class="mui-page-content">
				<div class="mui-scroll-wrapper">
					<div class="mui-scroll">
						<form class="mui-input-group">
							<div class="mui-input-row">
								<label>手机号</label>
								<input id='account' type="text" class="mui-input-clear mui-input" placeholder="请输入手机号" maxlength="11">
							</div>
							<div class="mui-input-row">
								<label>验证</label>
								<input id='password' type="password" class="mui-input" placeholder="请输入验证码">
								<button type="button" class="mui-btn code" id="getcode">获取验证码</button>
							</div>
						</form>
						<div class="mui-content-padded">
							<button id='reg' class="mui-btn mui-btn-block mui-btn-primary">绑定</button>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="mui-page" id="home">
			<div class="mui-navbar-inner mui-bar mui-bar-nav">
				<h1 class="mui-center mui-title">个人主页</h1>
			</div>
			<div class="mui-page-content">
				<div class="mui-scroll-wrapper">
					<div class="mui-scroll">
						<ul class="mui-table-view mui-table-view-chevron">
							<li class="mui-table-view-cell mui-media">
								<a class="mui-navigate-right" href="#account">
									<img class="mui-media-object mui-pull-left head-img" id="avatarUrl" src="images/timg.jpg">
									<div class="mui-media-body">
										<span id='nickname'>--</span>
										<p class='phone'>--</p>
									</div>
								</a>
							</li>
						</ul>
						<a href="#reg_phone" class="reg_phone" style="display:none" ><!-- style="display:none" -->
							<div class="mui-card">
								<div class="mui-card-content">
									<div class="mui-card-content-inner">
										<div class="card_title">点击绑定手机号</div>
										<div class="card_content">
											<span class="mui-icon iconfont icon-yduigantanhaokongxin"></span>手机号码作为您账户的唯一标识，绑定手机号后您可享受一系列优质服务。
										</div>
									</div>
								</div>
							</div>
						</a>
				        <ul class="mui-table-view mui-grid-view mui-grid-9">
				            <li class="mui-table-view-cell mui-media mui-col-xs-4 mui-col-sm-3"><a href="javascript:void(0)"  onclick='_czc.push(["_trackEvent", "个人主页", "钱包", "", "", ""]);'>
				                    <span class="mui-icon iconfont icon-qianbao"></span>
				                    <div class="mui-media-body">钱包</div></a></li>
				            <li class="mui-table-view-cell mui-media mui-col-xs-4 mui-col-sm-3"><a href="javascript:void(0)"  onclick='_czc.push(["_trackEvent", "个人主页", "红包", "", "", ""]);'>
				                    <span class="mui-icon iconfont icon-red"></span>
				                    <div class="mui-media-body">红包</div></a></li>
				            <li class="mui-table-view-cell mui-media mui-col-xs-4 mui-col-sm-3"><a href="javascript:void(0)">
				                    <span class="mui-icon iconfont icon-order"></span>
				                    <div class="mui-media-body">记录</div></a></li>
				            <li class="mui-table-view-cell mui-media mui-col-xs-4 mui-col-sm-3"><a href="javascript:void(0)">
				                    <span class="mui-icon iconfont icon-news"></span>
				                    <div class="mui-media-body">消息</div></a></li>
				            <li class="mui-table-view-cell mui-media mui-col-xs-4 mui-col-sm-3"><a href="javascript:void(0)">
				                    <span class="mui-icon iconfont icon-yduifenxiang1"></span>
				                    <div class="mui-media-body">分享</div></a></li>
				            <li class="mui-table-view-cell mui-media mui-col-xs-4 mui-col-sm-3"><a href="javascript:void(0)">
				                    <span class="mui-icon iconfont icon-yduiwenhao"></span>
				                    <div class="mui-media-body">帮助</div></a></li>
				            <li class="mui-table-view-cell mui-media mui-col-xs-4 mui-col-sm-3"><a a href="javascript:void(0)" >
				                    <span class="mui-icon iconfont icon-yduishezhi"></span>
				                    <div class="mui-media-body">设置</div></a></li>
				            <li class="mui-table-view-cell mui-media mui-col-xs-4 mui-col-sm-3"><a href="javascript:void(0)" id="more" onclick='_czc.push(["_trackEvent", "更多", "点击", "", "", "more"]);'>

				                    <span class="mui-icon iconfont icon-yduigengduo"></span>
				                    <div class="mui-media-body">更多</div></a></li>
		                    <li class="mui-table-view-cell mui-media mui-col-xs-4 mui-col-sm-3"><a href="pay_test.html">
				                    <span class="mui-icon iconfont icon-yduigengduo"></span>
				                  <div class="mui-media-body">支付test</div></a></li>
				        </ul> 
					</div>
				</div>
			</div>
				
		</div>

	</body>
	<script src="js/zepto.min.js"></script>
	<script src="js/mui/mui.min.js"></script>
	<script src="js/mui/mui.view.js "></script>
	<script src="js/page/login.js"></script>
	<script>
		mui.init({
			swipeBack:true //启用右滑关闭功能
		});
		//初始化单页view
		var viewApi = mui('#app').view({
			defaultPage: '#home'
		});
		//初始化单页的区域滚动
		mui('.mui-scroll-wrapper').scroll();
		var view = viewApi.view;
		(function($) {
			//处理view的后退与webview后退
			var oldBack = $.back;
			$.back = function() {
				if (viewApi.canBack()) { //如果view可以后退，则执行view的后退
					viewApi.back();
				} else { //执行webview后退
					oldBack();
				}
			};
			//监听页面切换事件方案1,通过view元素监听所有页面切换事件，目前提供pageBeforeShow|pageShow|pageBeforeBack|pageBack四种事件(before事件为动画开始前触发)
			//第一个参数为事件名称，第二个参数为事件回调，其中e.detail.page为当前页面的html对象
			view.addEventListener('pageBeforeShow', function(e) {
				//				console.log(e.detail.page.id + ' beforeShow');
			});
			view.addEventListener('pageShow', function(e) {
				//				console.log(e.detail.page.id + ' show');
			});
			view.addEventListener('pageBeforeBack', function(e) {
				//				console.log(e.detail.page.id + ' beforeBack');
			});
			view.addEventListener('pageBack', function(e) {
				//				console.log(e.detail.page.id + ' back');
			});
			
		})(mui);
		function getQueryString(name) {
	        var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i");
	        var r = window.location.search.substr(1).match(reg);
	        if (r != null) return unescape(r[2]);
	        return null;
	    }
	    var openid=getQueryString('openid');
		$.get("/getUser?openid="+openid,function(data,status){
			console.log(JSON.parse(data))
			var data = JSON.parse(data).data[0];
		    $('#avatarUrl').attr('src', data.avatarUrl);
		    $('#nickname').html(data.nickname);
		    if (data.phone) {
		    	$('#nickname').html(data.nickname);
		    }else{
		    	$('.reg_phone').show();
		    };
		});
		/*$('.mui-media').on('tap', function() {
				mui.toast('敬请期待...');
			});*/
		$('#getcode').on('tap',function(){
				var account = $('#account').val();
				if (!base.phoneCheck(account)) {
					mui.toast('请输入正确的手机号');
					return;
				}else{
					var _this = this;
					$.get("/sendNumToPhone?phone="+account,function(data,status){
						if (JSON.parse(data).msgNo == '0000' ) {
							mui.toast(JSON.parse(data).msgInfo);
							settime(_this);
						}else{
							mui.toast(JSON.parse(data).msgInfo);
						};
						
					});
					
				};
			})
			var countdown=10; 
			function settime(obj) { 
			    if (countdown == 0) { 
			        obj.removeAttribute("disabled");    
			        obj.innerHTML ="获取验证码"; 
			        countdown = 10; 
			        return;
			    } else { 
			        obj.setAttribute("disabled", true); 
			        obj.innerHTML ="重新发送(" + countdown + "s)"; 
			        countdown--; 
			    } 
			setTimeout(function() { 
			    settime(obj) }
			    ,1000) 
			}
	</script>
	
	<script src="https://s4.cnzz.com/z_stat.php?id=1260604409&web_id=1260604409" language="JavaScript"></script>
</html>